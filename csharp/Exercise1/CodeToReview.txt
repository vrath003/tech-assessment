using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Review
{
    public class People
    {
        private static readonly DateTimeOffset Under16 = DateTimeOffset.UtcNow.AddYears(-15);  //Under16 variable is declared once and it is readonly by all instances of class 
        public string Name { get; private set; }
        public DateTimeOffset DOB { get; private set; }

        public People(string name) : this(name, Under16.Date) { }
       /******************************************************************
       DOB variable is declared as DateTimeOffset type above(line 13) but passed as DateTime type below(line 20). 
       This creates inconsistency and there is a chance of loosing timezone offset.
       *********************************************************************/
        public People(string name, DateTime dob)
        {
            Name = name;
            DOB = dob;
        }
    }

    public class BirthingUnit
    {
        /// <summary>
        /// MaxItemsToRetrieve
        /// </summary>
        private List<People> _people;

        public BirthingUnit() {
            _people = new List<People>();
        }

        /// <summary>
        /// GetPeoples
        /// </summary>
        /// <param name="j"></param>  /* Correction: This comment is misleading. It should be param name="i" instead of param name="j" */
        /// <returns>List<object></returns>
        /*
        Above commenting could have been done in a tidy way as below.
        Below function returns a list of people objects with random name and age.
        */
        public List<People> GetPeople(int i)  
        {
            for (int j = 0; j < i; j++) {
                try
                {
                    // Creates a dandon Name  
                    /*Correction in comment above: work should be "random"  instead of "dandon" */
                    string name = string.Empty;
                    /* random variable below is re created whenever the loop runs. This should be outside the loop. */
                    var random = new Random();
                    /*Correction: In below line random.Next(0,1) will always return 0 therefore it can be corrected to random.Next(0, 2) instead of random.Next(0, 1)*/
                    if (random.Next(0, 1) == 0) {  
                        name = "Bob";
                    }
                    else { name = "Betty"; }
                    // Adds new people to the list
                    _people.Add(new People(name, DateTime.UtcNow.Subtract(new TimeSpan(random.Next(18, 85) * 356, 0, 0, 0))));
                }
                catch (Exception e)
                {
                    // Dont think this should ever happen
                    throw new Exception("Something failed in user creation");
                }
            }
            return _people;
        }

        private IEnumerable<People> GetBobs(bool olderThan30) {
            return olderThan30 ? _people.Where(x => x.Name == "Bob" && x.DOB >= DateTime.Now.Subtract(new TimeSpan(30 * 356, 0, 0, 0))) : _people.Where(x => x.Name == "Bob");
        }

        public string GetMarried(People p, string lastName)
        {
            if (lastName.Contains("test"))
                return p.Name;
            if ((p.Name.Length + lastName).Length > 255) {
                (p.Name + " " + lastName).Substring(0, 255);
            }

            return p.Name + " " + lastName;
        }
    }
}